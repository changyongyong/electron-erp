<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<title>terminal application</title>
		<script src="http://127.0.0.1:3000/socket.io/socket.io.js"></script>
		<script src="http://127.0.0.1:3000/socket.io-stream.js"></script>
		<script src="http://127.0.0.1:3000/terminal.js"></script>
             <!--   <script src="http://requirejs.org/docs/release/2.1.17/minified/require.js"></script> -->

                <script src="/bower_components/jquery/dist/jquery.min.js"></script>

		<style>
.terminaljs {
	background: green;
	color: white;
	font-family: Courier, monospace;
	display:inline-block;
}
		</style>
	</head>
	<body>

<form>
First name:<br>
<input id="field01" type="text" name="firstname">
<br>
Last name:<br>
<input id="field02" type="text" name="lastname">
</form>

<pre class="terminaljs" id="terminal01" data-name="terminal" data-columns="120" data-rows="35"></pre>

<script>


//require.config ({
//  paths: { 
//       'jquery': '/bower_components/jquery/dist/jquery.min'
//   }
//});

//window.$ = window.jQuery = require( ['jquery'], function(jquery) {});


var container = document.getElementById('terminal01');
var field01 = document.getElementById('field01');
var socket = io( 'http://127.0.0.1:3000/pty');

var term, stream;

console.log( "location origin: " + location.origin );
console.log( "field01: " + field01 );
//cconsole.log( "ss: " + ss );

	// setting tabindex makes the element focusable
	container.tabindex = 0;
	
        // use data-* attributes to configure terminal and child_pty
	term = new Terminal(container.dataset);

	// Create bidirectional stream
	stream = ss.createStream( {decodeStrings: false, encoding: 'utf-8'} );
	
        // Send stream and options to the server
	ss(socket).emit('new', stream, container.dataset);

        
        debugger;
 
        // Connect everything up
	stream.pipe(term).dom(container).pipe(stream);

        container.focus();
        

console.log("terminal end script") ;

window.onbeforeunload = function(e) {
  //console.log('I do not want to be closed');
  // alert( 'ne mozes me zatvoriti' );
  // Unlike usual browsers, in which a string should be returned and the user is
  // prompted to confirm the page unload. Electron gives the power completely
  // to the developers, return empty string or false would prevent the unloading
  // now. You can also use the dialog API to let user confirm it.
  //return false;
  return true;
};

jQuery("input").change( function() {
  //console.log( "text changed" );
  
  var stream2 = ss.createStream();
  ss(socket).emit('field01', stream2, { cmd: "xxxx" } );
   
  stream2.pipe(term).dom(field01).pipe(stream2 );	
});

</script>

</body>
</html>
